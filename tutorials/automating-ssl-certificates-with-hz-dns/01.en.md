---
SPDX-License-Identifier: MIT
path: "/tutorials/automating-ssl-certificates"
slug: "automating-ssl-certificates-with-hz-dns"
date: "2023-08-19"
title: "Automating SSL Certificates Issuance with Certbot and Acme.sh through hz dns"
short_description: "This tutorial provides a comparison between two automation tools, Certbot and Acme.sh, and demonstrates how to use them to automate SSL certificates issuance on your own server."
tags: ["Development", "SSL", "Certbot", "Acme.sh", "Ubuntu"]
author: "chunzhimoe"
author_link: "https://github.com/chunzhimoe"
author_img: "https://avatars.githubusercontent.com/u/60135925"
author_description: "hello,neko"
language: "en"
available_languages: ["en"]
header_img: "header-1"
cta: "dnsÔºåcloud"
---

## Introduction

This article aims to document the process of automating SSL certificate issuance and serve as a reference for future applications. It compares two automation tools: certbot and acme.sh, and provides step-by-step instructions for using these tools to issue certificates on your own server. Certbot is recommended for single-server deployments, as it has simpler commands and primarily supports foreign DNS providers compared to acme.sh. Acme.sh, on the other hand, is a shell-based tool that offers better performance and supports multiple DNS provider APIs, making it suitable for automating SSL certificates and nginx deployment. The article also includes instructions for using acme.sh on google caÔºåbuypass ca for certificate issuance and concludes with a section on downloading the issued certificates.

**Prerequisites**

* Hetzner DNS API token 
* Hetzner Cloud
* [SSH key](https://community.hetzner.com/tutorials/howto-ssh-key)
* Ubuntu server
* Nginx installed
* Domain name ON Hetzner dns

## Step 1 - Installing Certbot

Certbot is suitable for single-server deployments and offers simpler commands compared to acme.sh. It primarily supports some DNS providers and is recommended for users who prefer a straightforward approach to SSL certificate deployment.

```shell
sudo apt update && apt -y install nginx && apt -y install python3-certbot-nginx
certbot --help
```

If the package python3-cerbot-nginx is not available in your  system's package repository. Please try the following commands to install Certbot:

Add the Certbot repository:

```shell
sudo apt-get update
sudo add-apt-repository ppa:certbot/certbot
sudo apt-get update
```

Install Certbot:

```shell
sudo apt-get install  python3-certbot-nginx && apt install nginx
```

## Step 2 - Configuring Nginx

Once you have set up DNS resolution for your domain to point to your server's IP address, you can proceed to the next steps.

```shell
cd /etc/nginx/sites-enabled
nano sites.conf
```

Here's an example configuration for a reverse proxy, but this may not work for you. For better nginx configuration, you can use the following link:

[digitalocean/nginxconfig.io: ‚öôÔ∏è NGINX config generator on steroids üíâ (github.com)](https://github.com/digitalocean/nginxconfig.io)

Add the following server block configuration to the file:

```shell
server {
    listen 80;
    listen [::]:80;
    server_name rsshub.examle.com; # Replace with your domain
}

server {
    listen 443 ssl;
    server_name rsshub.examle.com; # Replace with your domain
    ssl_certificate /ssl/1.pem; # Replace with your self-signed SSL certificate
    ssl_certificate_key /ssl/1.key; # Replace with your self-signed SSL key
    location / {
        proxy_pass http://127.0.0.1:1200;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

Save the changes and test the nginx configuration:

```shell
nginx -t
```

If the configuration test is successful, restart nginx:

```shell
systemctl restart nginx
```

## Step 3 - Issuing Certificates Using Certbot

To issue the certificate using certbot, run the following command:

```shell
certbot --nginx
```

The command will automatically issue the certificate, as shown in the output. Certbot will also handle automatic certificate renewal, making it extremely convenient.

## Step 4 - Installing and Using Acme.sh

For issuing certificates using acme.sh, it is recommended to use Hetzner Cloud, which provides a high-performance server at a low price, and you can easily remember the renewal command for certificate renewal.

```shell
git clone https://github.com/acmesh-official/acme.sh.git
cd acme.sh
./acme.sh --install -m my@example.com
```

Replace `-m my@example.com` with your email address.

Once the installation is complete, the installation path will be displayed.

## Step 5 - Modifying Automated DNS

Refer to the acme.sh wiki for the list of supported DNS providers:

https://github.com/acmesh-official/acme.sh/wiki/dnsapi

For demonstration purposes, I will use Hetzner DNS. Please note that the API keys provided by each DNS provider may differ. Please read the above wiki and choose the best provider for you. For Hetzner DNS, you can get your API key at [DNS Console - Hetzner Online GmbH](https://dns.hetzner.com/settings/api-token).

Note down the key for your DNS provider.

```shell
cd acme.sh/dnsapi
```

In this directory, you will find various API options for different DNS providers. If you are unsure which one to use, refer to the acme.sh wiki for guidance:

https://github.com/acmesh-official/acme.sh/blob/master/dnsapi/

Find the corresponding script for your DNS provider, such as `dns_hetzner.sh` for Hetzner, and edit it:

```shell
nano dns_hetzner.sh
```

Modify the script to include your DNS provider's API key and save the changes.

## Step 6 - Issuing Certificates Using Acme.sh

Starting from acme.sh v3.0.6, the default key algorithm is ec-256, not RSA2048. However, If your CA only supports RSA4096 and below. To issue a free certificate, you need to specify the key length as `-k 2048` at the end of the command.

The commit is [Use ec-256 as default key length ¬∑ acmesh-official/acme.sh@ec0e871 (github.com)](https://github.com/acmesh-official/acme.sh/commit/ec0e871592d286b8cd4e1d407411f0ba17c775e6)

Run the following command to issue the certificate:

```shell
acme.sh --issue --dns dns_hetzner -d example.com -d *.example.com 
```

This command performs automatic DNS verification. Once the verification is successful, you can download the certificate.

## Step 7 - Issuing Certificates  Buypass CA or Google CA

Refer to the respective documentation for issuing certificates from Buypass and Google CA:

- Buypass Certificate: [Buypass Certificate - ACME Protocol Support](https://www.buypass.com/acme-docs/)
- Google Certificate: [Google Public CA - acmesh-official/acme.sh Wiki](https://github.com/acmesh-official/acme.sh/wiki/Google-Public-CA)

**To issue a Buypass certificate, run the following commands:**

```shell
acme.sh --server https://api.buypass.com/acme/directory --register-account --accountemail me@example.com
acme.sh --server https://api.buypass.com/acme/directory --issue -d example.com -d www.example.com --days 170 --dns dns_hetzner
```

**To issue a Google certificate, follow the steps below:**

Open the Google Cloud Certificate API:

https://console.cloud.google.com/apis/library/publicca.googleapis.com?project=xxxxx

Note: Replace `xxxxx` with your project ID and click the enable button.

Open Cloud Shell and obtain credentials:

In the Cloud Shell, enter the following command:

```shell
gcloud beta publicca external-account-keys create
```

The output will be displayed as follows:

```
[b64MacKey: balabalabala keyId: balabalabala]
```

Save this information; you'll need it later.

```shell
acme.sh --register-account -m myemail@example.com --server google
--eab-kid xxxxxxx
--eab-hmac-key xxxxxxx
```

Issue the Google certificate:

```shell
acme.sh --issue --server google -d example.com --dns dns_hetzner
```

Here is a successful Certificate Issuance Example

**[Sat 19 Aug 2023 02:28:09 AM UTC] Your cert is in: /home/admin_/.acme.sh/**  
**[Sat 19 Aug 2023 02:28:09 AM UTC] Your cert key is in: /home/admin_/.acme.sh/**  
**[Sat 19 Aug 2023 02:28:09 AM UTC] The intermediate CA cert is in: /home/admin_/.acme.sh/**  
**[Sat 19 Aug 2023 02:28:09 AM UTC] And the full chain certs is there: /home/admin_/.acme.sh/**  

**If the issuance fails, an error message will be returned to help you solve the problem.**

## Step 8 - Downloading Certificates

After issuing the certificates, you can find them in the designated location. Simply open the files with a text editor to view the details.

## Conclusion

In this tutorial, you have learned how to automate the issuance of SSL certificates using Certbot and Acme.sh. You have also learned how to configure Nginx and modify DNS settings to suit your needs. With these tools and instructions, you can easily secure your websites and services with SSL certificates.

##### License: MIT

<!--

Contributor's Certificate of Origin

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I have
    the right to submit it under the license indicated in the file; or

(b) The contribution is based upon previous work that, to the best of my
    knowledge, is covered under an appropriate license and I have the
    right under that license to submit that work with modifications,
    whether created in whole or in part by me, under the same license
    (unless I am permitted to submit under a different license), as
    indicated in the file; or

(c) The contribution was provided directly to me by some other person
    who certified (a), (b) or (c) and I have not modified it.

(d) I understand and agree that this project and the contribution are
    public and that a record of the contribution (including all personal
    information I submit with it, including my sign-off) is maintained
    indefinitely and may be redistributed consistent with this project
    or the license(s) involved.

Signed-off-by: peter chen (chunzhi@18g.me)

-->
